<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scratch é£æ ¼ä¸»é¢˜æ¼”ç¤º</title>
    <script src="blockly.min.js"></script>
    <script src="scratch-theme.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            margin: 0;
            color: #FF8C1A;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            margin: 10px 0 0 0;
            color: #575E75;
            font-size: 1.1em;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .demo-section h2 {
            color: #FF8C1A;
            margin-top: 0;
            font-size: 1.8em;
            font-weight: 600;
        }

        .blockly-container {
            height: 600px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #FF8C1A, #FF6B35);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 140, 26, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 26, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #4C97FF, #3373CC);
            box-shadow: 0 4px 15px rgba(76, 151, 255, 0.3);
        }

        .btn.secondary:hover {
            box-shadow: 0 6px 20px rgba(76, 151, 255, 0.4);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .color-item:hover {
            border-color: #FF8C1A;
            transform: scale(1.05);
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .color-name {
            font-weight: 600;
            color: #575E75;
            font-size: 14px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .feature-card h3 {
            color: #FF8C1A;
            margin-top: 0;
            font-size: 1.2em;
        }

        .feature-card p {
            color: #575E75;
            margin: 0;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ Scratch é£æ ¼ä¸»é¢˜</h1>
        <p>åŸºäº Scratch çš„é²œæ˜é…è‰²å’Œæ‰å¹³åŒ–è®¾è®¡</p>
    </div>

    <div class="container">
        <div class="demo-section">
            <h2>ğŸ¯ ä¸»é¢˜ç‰¹è‰²</h2>
            <div class="features">
                <div class="feature-card">
                    <h3>ğŸŒˆ é²œæ˜é…è‰²</h3>
                    <p>é‡‡ç”¨ Scratch å®˜æ–¹é…è‰²æ–¹æ¡ˆï¼Œæ¯ä¸ªç±»åˆ«éƒ½æœ‰ç‹¬ç‰¹çš„é¢œè‰²æ ‡è¯†ï¼Œè®©ç¼–ç¨‹æ›´åŠ ç›´è§‚æœ‰è¶£ã€‚</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ“± æ‰å¹³åŒ–è®¾è®¡</h3>
                    <p>ç°ä»£åŒ–çš„æ‰å¹³è®¾è®¡é£æ ¼ï¼Œå»é™¤å¤šä½™çš„é˜´å½±å’Œæ¸å˜ï¼Œè®©ç•Œé¢æ›´åŠ ç®€æ´æ¸…çˆ½ã€‚</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸª åœ†è§’è®¾è®¡</h3>
                    <p>æ‰€æœ‰ç§¯æœ¨å—éƒ½é‡‡ç”¨åœ†è§’è®¾è®¡ï¼Œè§†è§‰æ•ˆæœæ›´åŠ æŸ”å’Œå‹å¥½ã€‚</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ”¤ ç°ä»£å­—ä½“</h3>
                    <p>ä½¿ç”¨ Helvetica Neue å­—ä½“ï¼Œæä¾›æ›´å¥½çš„å¯è¯»æ€§å’Œç°ä»£æ„Ÿã€‚</p>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>ğŸ¨ é…è‰²æ–¹æ¡ˆ</h2>
            <div class="color-palette">
                <div class="color-item">
                    <div class="color-swatch" style="background: #4C97FF;"></div>
                    <span class="color-name">è¿åŠ¨ - è“è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #9966FF;"></div>
                    <span class="color-name">å¤–è§‚ - ç´«è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #CF63CF;"></div>
                    <span class="color-name">å£°éŸ³ - ç²‰è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #FFBF00;"></div>
                    <span class="color-name">äº‹ä»¶ - é»„è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #FF8C1A;"></div>
                    <span class="color-name">æ§åˆ¶ - æ©™è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #5CB1D6;"></div>
                    <span class="color-name">ä¾¦æµ‹ - æµ…è“</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #40BF4A;"></div>
                    <span class="color-name">è¿ç®— - ç»¿è‰²</span>
                </div>
                <div class="color-item">
                    <div class="color-swatch" style="background: #FF661A;"></div>
                    <span class="color-name">å˜é‡ - çº¢è‰²</span>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>ğŸš€ äº¤äº’æ¼”ç¤º</h2>
            <div class="controls">
                <button class="btn" onclick="createSampleProject()">åˆ›å»ºç¤ºä¾‹é¡¹ç›®</button>
                <button class="btn secondary" onclick="clearWorkspace()">æ¸…ç©ºå·¥ä½œåŒº</button>
                <button class="btn" onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
                <button class="btn secondary" onclick="exportCode()">å¯¼å‡ºä»£ç </button>
            </div>
            <div id="blocklyDiv" class="blockly-container"></div>
        </div>
    </div>

    <script>
        let workspace;
        let currentTheme = 'scratch';

        // åˆå§‹åŒ– Blockly
        function initBlockly() {
            // ç¡®ä¿ç”Ÿæˆå™¨å·²æ³¨å†Œ
            ensureGeneratorsRegistered();
            
            // åˆ›å»ºå·¥ä½œåŒº
            workspace = Blockly.inject('blocklyDiv', {
                toolbox: createScratchToolbox(),
                scrollbars: true,
                trashcan: true,
                grid: {
                    spacing: 20,
                    length: 3,
                    colour: '#E5E5E5',
                    snap: true
                },
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                move: {
                    scrollbars: true,
                    drag: true,
                    wheel: true
                }
            });

            // åº”ç”¨ Scratch ä¸»é¢˜
            applyScratchTheme(workspace);
            
            console.log('Blockly å·¥ä½œåŒºåˆå§‹åŒ–å®Œæˆï¼Œåº”ç”¨ Scratch ä¸»é¢˜');
        }

        // ç¡®ä¿ç”Ÿæˆå™¨å·²æ³¨å†Œ
        function ensureGeneratorsRegistered() {
            // å½“ç¨‹åºå¼€å§‹æ—¶
            Blockly.JavaScript['when_program_starts'] = function(block) {
                return '';
            };
            
            // ç­‰å¾…ç§’æ•°
            Blockly.JavaScript['wait_seconds'] = function(block) {
                const seconds = block.getFieldValue('SECONDS') || '1';
                return `await waitSeconds(${seconds});\n`;
            };
            
            // ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®
            Blockly.JavaScript['motion_movesteps'] = function(block) {
                const steps = block.getFieldValue('STEPS') || '10';
                return `await moveSteps(${steps});\n`;
            };
            
            // è½¬å‘
            Blockly.JavaScript['motion_turnright'] = function(block) {
                const degrees = block.getFieldValue('DEGREES') || '15';
                return `await turnRight(${degrees});\n`;
            };
            
            // å¹¿æ’­æ¶ˆæ¯
            Blockly.JavaScript['broadcast_message'] = function(block) {
                const messageName = block.getFieldValue('MESSAGE_NAME') || 'æ¶ˆæ¯';
                return `broadcastMessage('${messageName}');\n`;
            };
            
            // å½“æ¶ˆæ¯æ¥æ”¶æ—¶
            Blockly.JavaScript['when_message_received'] = function(block) {
                const messageName = block.getFieldValue('MESSAGE_NAME') || 'æ¶ˆæ¯';
                return `addMessageListener('${messageName}', async function() {\n`;
            };
        }

        // åˆ›å»ºç¤ºä¾‹é¡¹ç›®
        function createSampleProject() {
            if (!workspace) return;
            
            workspace.clear();
            
            // åˆ›å»ºç¨‹åºå¼€å§‹å—
            const startBlock = workspace.newBlock('when_program_starts');
            startBlock.initSvg();
            startBlock.render();
            startBlock.moveBy(50, 50);
            
            // åˆ›å»ºç­‰å¾…å—
            const waitBlock = workspace.newBlock('wait_seconds');
            waitBlock.setFieldValue('2', 'SECONDS');
            waitBlock.initSvg();
            waitBlock.render();
            startBlock.getNextBlock = function() { return waitBlock; };
            waitBlock.moveBy(0, 80);
            
            // åˆ›å»ºå¹¿æ’­æ¶ˆæ¯å—
            const broadcastBlock = workspace.newBlock('broadcast_message');
            broadcastBlock.setFieldValue('hello', 'MESSAGE_NAME');
            broadcastBlock.initSvg();
            broadcastBlock.render();
            waitBlock.getNextBlock = function() { return broadcastBlock; };
            broadcastBlock.moveBy(0, 80);
            
            // åˆ›å»ºæ¶ˆæ¯æ¥æ”¶å—
            const messageBlock = workspace.newBlock('when_message_received');
            messageBlock.setFieldValue('hello', 'MESSAGE_NAME');
            messageBlock.initSvg();
            messageBlock.render();
            messageBlock.moveBy(300, 50);
            
            // åˆ›å»ºç§»åŠ¨å—
            const moveBlock = workspace.newBlock('motion_movesteps');
            moveBlock.setFieldValue('50', 'STEPS');
            moveBlock.initSvg();
            moveBlock.render();
            messageBlock.getNextBlock = function() { return moveBlock; };
            moveBlock.moveBy(0, 80);
            
            // åˆ›å»ºè½¬å‘å—
            const turnBlock = workspace.newBlock('motion_turnright');
            turnBlock.setFieldValue('90', 'DEGREES');
            turnBlock.initSvg();
            turnBlock.render();
            moveBlock.getNextBlock = function() { return turnBlock; };
            turnBlock.moveBy(0, 80);
            
            console.log('ç¤ºä¾‹é¡¹ç›®åˆ›å»ºå®Œæˆ');
        }

        // æ¸…ç©ºå·¥ä½œåŒº
        function clearWorkspace() {
            if (workspace) {
                workspace.clear();
                console.log('å·¥ä½œåŒºå·²æ¸…ç©º');
            }
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            if (!workspace) return;
            
            if (currentTheme === 'scratch') {
                // åˆ‡æ¢åˆ°é»˜è®¤ä¸»é¢˜
                workspace.setTheme(Blockly.Themes.Classic);
                currentTheme = 'classic';
                console.log('åˆ‡æ¢åˆ°ç»å…¸ä¸»é¢˜');
            } else {
                // åˆ‡æ¢åˆ° Scratch ä¸»é¢˜
                applyScratchTheme(workspace);
                currentTheme = 'scratch';
                console.log('åˆ‡æ¢åˆ° Scratch ä¸»é¢˜');
            }
        }

        // å¯¼å‡ºä»£ç 
        function exportCode() {
            if (!workspace) return;
            
            try {
                const code = Blockly.JavaScript.workspaceToCode(workspace);
                console.log('ç”Ÿæˆçš„ä»£ç :', code);
                alert('ä»£ç å·²ç”Ÿæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º');
            } catch (error) {
                console.error('ä»£ç ç”Ÿæˆå¤±è´¥:', error);
                alert('ä»£ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ– Blockly...');
            initBlockly();
        });
    </script>
</body>
</html> 