<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é‡æ§åˆ¶æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-section h2 {
            color: #666;
            margin-bottom: 15px;
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }
        .volume-slider {
            flex: 1;
        }
        .volume-display {
            min-width: 60px;
            text-align: center;
            font-weight: bold;
            color: #333;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .code-preview {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .log-container {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        .log-entry.worker {
            color: #68d391;
        }
        .log-entry.main {
            color: #63b3ed;
        }
        .log-entry.sound {
            color: #f6ad55;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ éŸ³é‡æ§åˆ¶æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š éŸ³é‡æ§åˆ¶</h2>
            <p>æµ‹è¯•éŸ³é‡è®¾ç½®å’Œè·å–åŠŸèƒ½</p>
            
            <div class="volume-control">
                <label>éŸ³é‡:</label>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
                <span class="volume-display" id="volumeDisplay">100%</span>
            </div>
            
            <div class="volume-control">
                <label>éŸ³é‡å˜åŒ–:</label>
                <input type="range" class="volume-slider" id="volumeChangeSlider" min="-100" max="100" value="0">
                <span class="volume-display" id="volumeChangeDisplay">0</span>
            </div>
            
            <button class="test-button" onclick="testSetVolume()">è®¾ç½®éŸ³é‡</button>
            <button class="test-button" onclick="testGetVolume()">è·å–éŸ³é‡</button>
            <button class="test-button" onclick="testChangeVolume()">æ”¹å˜éŸ³é‡</button>
            <button class="test-button" onclick="testVolumeLoop()">éŸ³é‡å¾ªç¯æµ‹è¯•</button>
            
            <div class="code-preview">// æµ‹è¯•ä»£ç 
setVolume(50);           // è®¾ç½®éŸ³é‡ä¸º50%
getVolume();             // è·å–å½“å‰éŸ³é‡
setVolume(getVolume() + 10);  // å¢åŠ 10%éŸ³é‡</div>
            
            <div id="volume-status" class="status"></div>
        </div>

        <div class="test-section">
            <h2>ğŸµ å£°éŸ³æ’­æ”¾æµ‹è¯•</h2>
            <p>æµ‹è¯•éŸ³é‡å¯¹å£°éŸ³æ’­æ”¾çš„å½±å“</p>
            
            <button class="test-button" onclick="playTestSound()">æ’­æ”¾æµ‹è¯•å£°éŸ³</button>
            <button class="test-button" onclick="stopTestSound()">åœæ­¢å£°éŸ³</button>
            <button class="test-button" onclick="testVolumeWithSound()">éŸ³é‡+å£°éŸ³æµ‹è¯•</button>
            
            <div id="sound-status" class="status"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h2>
            <p>æŸ¥çœ‹éŸ³é‡æ§åˆ¶çš„è¯¦ç»†æ—¥å¿—</p>
            
            <button class="test-button" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            <button class="test-button" onclick="exportLog()">å¯¼å‡ºæ—¥å¿—</button>
            
            <div class="log-container" id="logContainer">
                <div class="log-entry">ğŸµ éŸ³é‡æ§åˆ¶æµ‹è¯•é¡µé¢å·²åŠ è½½</div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸéŸ³é‡æ§åˆ¶å‡½æ•°
        let currentVolume = 100;
        let testAudio = null;
        let logEntries = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logEntries.push({ message: logEntry, type });
            
            const logContainer = document.getElementById('logContainer');
            const logElement = document.createElement('div');
            logElement.className = `log-entry ${type}`;
            logElement.textContent = logEntry;
            logContainer.appendChild(logElement);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function updateVolumeDisplay() {
            document.getElementById('volumeDisplay').textContent = `${currentVolume}%`;
            document.getElementById('volumeSlider').value = currentVolume;
        }

        // æ¨¡æ‹Ÿ setVolume å‡½æ•°
        function setVolume(volume) {
            const oldVolume = currentVolume;
            currentVolume = Math.max(0, Math.min(100, volume));
            
            addLog(`ğŸµ è®¾ç½®éŸ³é‡: ${oldVolume}% â†’ ${currentVolume}%`, 'sound');
            
            // å¦‚æœæœ‰æµ‹è¯•éŸ³é¢‘ï¼Œæ›´æ–°å…¶éŸ³é‡
            if (testAudio) {
                testAudio.volume = currentVolume / 100;
                addLog(`ğŸµ æ›´æ–°æµ‹è¯•éŸ³é¢‘éŸ³é‡: ${currentVolume}%`, 'sound');
            }
            
            updateVolumeDisplay();
            return currentVolume;
        }

        // æ¨¡æ‹Ÿ getVolume å‡½æ•°
        function getVolume() {
            addLog(`ğŸµ è·å–éŸ³é‡: ${currentVolume}%`, 'sound');
            return currentVolume;
        }

        function testSetVolume() {
            try {
                const volume = parseInt(document.getElementById('volumeSlider').value);
                setVolume(volume);
                updateStatus('volume-status', `âœ… éŸ³é‡è®¾ç½®æˆåŠŸï¼å½“å‰éŸ³é‡: ${currentVolume}%`, 'success');
            } catch (error) {
                updateStatus('volume-status', `âŒ éŸ³é‡è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testGetVolume() {
            try {
                const volume = getVolume();
                updateStatus('volume-status', `âœ… éŸ³é‡è·å–æˆåŠŸï¼å½“å‰éŸ³é‡: ${volume}%`, 'success');
            } catch (error) {
                updateStatus('volume-status', `âŒ éŸ³é‡è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testChangeVolume() {
            try {
                const change = parseInt(document.getElementById('volumeChangeSlider').value);
                const newVolume = setVolume(getVolume() + change);
                updateStatus('volume-status', `âœ… éŸ³é‡æ”¹å˜æˆåŠŸï¼å˜åŒ–: ${change}%, æ–°éŸ³é‡: ${newVolume}%`, 'success');
            } catch (error) {
                updateStatus('volume-status', `âŒ éŸ³é‡æ”¹å˜å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testVolumeLoop() {
            try {
                addLog('ğŸ”„ å¼€å§‹éŸ³é‡å¾ªç¯æµ‹è¯•', 'info');
                
                // æ¨¡æ‹Ÿå¾ªç¯æµ‹è¯•
                for (let i = 0; i <= 100; i += 10) {
                    setVolume(i);
                    const retrievedVolume = getVolume();
                    if (retrievedVolume !== i) {
                        throw new Error(`éŸ³é‡ä¸åŒ¹é…: è®¾ç½®${i}%, è·å–${retrievedVolume}%`);
                    }
                }
                
                updateStatus('volume-status', `âœ… éŸ³é‡å¾ªç¯æµ‹è¯•æˆåŠŸï¼æ‰€æœ‰éŸ³é‡å€¼éƒ½æ­£ç¡®`, 'success');
                addLog('âœ… éŸ³é‡å¾ªç¯æµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                updateStatus('volume-status', `âŒ éŸ³é‡å¾ªç¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                addLog(`âŒ éŸ³é‡å¾ªç¯æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function playTestSound() {
            try {
                // åˆ›å»ºæµ‹è¯•éŸ³é¢‘ï¼ˆä½¿ç”¨Web Audio APIç”Ÿæˆä¸€ä¸ªç®€å•çš„éŸ³è°ƒï¼‰
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4éŸ³
                oscillator.type = 'sine';
                
                // è®¾ç½®éŸ³é‡
                gainNode.gain.setValueAtTime(currentVolume / 100, audioContext.currentTime);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 2); // æ’­æ”¾2ç§’
                
                testAudio = { oscillator, gainNode, audioContext };
                
                updateStatus('sound-status', `âœ… æµ‹è¯•å£°éŸ³æ’­æ”¾æˆåŠŸï¼éŸ³é‡: ${currentVolume}%`, 'success');
                addLog(`ğŸµ æ’­æ”¾æµ‹è¯•å£°éŸ³ï¼ŒéŸ³é‡: ${currentVolume}%`, 'sound');
            } catch (error) {
                updateStatus('sound-status', `âŒ æµ‹è¯•å£°éŸ³æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
                addLog(`âŒ æµ‹è¯•å£°éŸ³æ’­æ”¾å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function stopTestSound() {
            try {
                if (testAudio) {
                    testAudio.oscillator.stop();
                    testAudio = null;
                    updateStatus('sound-status', `âœ… æµ‹è¯•å£°éŸ³å·²åœæ­¢`, 'success');
                    addLog(`ğŸµ æµ‹è¯•å£°éŸ³å·²åœæ­¢`, 'sound');
                } else {
                    updateStatus('sound-status', `â„¹ï¸ æ²¡æœ‰æ­£åœ¨æ’­æ”¾çš„æµ‹è¯•å£°éŸ³`, 'info');
                }
            } catch (error) {
                updateStatus('sound-status', `âŒ åœæ­¢æµ‹è¯•å£°éŸ³å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testVolumeWithSound() {
            try {
                addLog('ğŸµ å¼€å§‹éŸ³é‡+å£°éŸ³æµ‹è¯•', 'sound');
                
                // æ’­æ”¾å£°éŸ³å¹¶æµ‹è¯•ä¸åŒéŸ³é‡
                const volumes = [100, 50, 25, 10, 0];
                
                volumes.forEach((volume, index) => {
                    setTimeout(() => {
                        setVolume(volume);
                        playTestSound();
                        addLog(`ğŸµ æµ‹è¯•éŸ³é‡ ${volume}%`, 'sound');
                    }, index * 3000); // æ¯3ç§’æµ‹è¯•ä¸€ä¸ªéŸ³é‡
                });
                
                updateStatus('sound-status', `âœ… éŸ³é‡+å£°éŸ³æµ‹è¯•å·²å¯åŠ¨ï¼Œå°†ä¾æ¬¡æµ‹è¯•: ${volumes.join('%, ')}%`, 'success');
            } catch (error) {
                updateStatus('sound-status', `âŒ éŸ³é‡+å£°éŸ³æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
            logEntries = [];
            addLog('ğŸ§¹ æ—¥å¿—å·²æ¸…é™¤', 'info');
        }

        function exportLog() {
            const logText = logEntries.map(entry => entry.message).join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `volume-test-log-${new Date().toISOString().slice(0, 19)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            addLog('ğŸ“ æ—¥å¿—å·²å¯¼å‡º', 'info');
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('volumeSlider').addEventListener('input', function() {
            document.getElementById('volumeDisplay').textContent = `${this.value}%`;
        });

        document.getElementById('volumeChangeSlider').addEventListener('input', function() {
            document.getElementById('volumeChangeDisplay').textContent = this.value;
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateVolumeDisplay();
            addLog('ğŸµ éŸ³é‡æ§åˆ¶æµ‹è¯•é¡µé¢å·²åˆå§‹åŒ–', 'info');
            updateStatus('volume-status', 'ğŸ“Š éŸ³é‡æ§åˆ¶æµ‹è¯•å·²å‡†å¤‡å°±ç»ª', 'info');
            updateStatus('sound-status', 'ğŸµ å£°éŸ³æ’­æ”¾æµ‹è¯•å·²å‡†å¤‡å°±ç»ª', 'info');
        });
    </script>
</body>
</html> 