<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å£°éŸ³ç®¡ç†æ–¹æ¡ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.playing {
            background: #d4edda;
            color: #155724;
        }
        .status.stopped {
            background: #f8d7da;
            color: #721c24;
        }
        .status.ready {
            background: #d1ecf1;
            color: #0c5460;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        .sound-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        .sound-item {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸµ æ–°å£°éŸ³ç®¡ç†æ–¹æ¡ˆæµ‹è¯•</h1>
    
    <div class="container">
        <h2>æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªæµ‹è¯•éªŒè¯æ–°çš„å£°éŸ³ç®¡ç†æ–¹æ¡ˆï¼š</p>
        <ul>
            <li>ä½¿ç”¨å…¨å±€æ’­æ”¾å­—å…¸ç®¡ç†æ­£åœ¨æ’­æ”¾çš„å£°éŸ³</li>
            <li>æ”¯æŒæ’­æ”¾ä¸å­˜åœ¨çš„å£°éŸ³ï¼ˆåˆ›å»ºé»˜è®¤éŸ³é¢‘ï¼‰</li>
            <li>ç²¾ç¡®åœæ­¢ç‰¹å®šå£°éŸ³æˆ–æ‰€æœ‰å£°éŸ³</li>
            <li>ç¨‹åºç»“æŸæ—¶æ¸…ç†æ‰€æœ‰éŸ³é¢‘èµ„æº</li>
        </ul>
    </div>

    <div class="container">
        <h2>æ§åˆ¶æŒ‰é’®</h2>
        <button class="success" onclick="playSound('karen')">ğŸµ æ’­æ”¾ karen</button>
        <button class="success" onclick="playSound('music')">ğŸµ æ’­æ”¾ music</button>
        <button class="success" onclick="playSound('beep')">ğŸµ æ’­æ”¾ beep</button>
        <button onclick="stopSound('karen')">â¹ï¸ åœæ­¢ karen</button>
        <button onclick="stopSound('music')">â¹ï¸ åœæ­¢ music</button>
        <button class="danger" onclick="stopAllSounds()">â¹ï¸ åœæ­¢æ‰€æœ‰å£°éŸ³</button>
        <button onclick="clearLog()">ğŸ§¹ æ¸…é™¤æ—¥å¿—</button>
        
        <div id="status" class="status ready">å‡†å¤‡å°±ç»ª</div>
    </div>

    <div class="container">
        <h2>å½“å‰çŠ¶æ€</h2>
        <div>æ­£åœ¨æ’­æ”¾çš„å£°éŸ³æ•°é‡: <span id="playingCount">0</span></div>
        <div>æ’­æ”¾å­—å…¸å†…å®¹: <span id="playingList">æ— </span></div>
        <div class="sound-list" id="soundList"></div>
    </div>

    <div class="container">
        <h2>æ‰§è¡Œæ—¥å¿—</h2>
        <div id="log" class="log"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ–°çš„å£°éŸ³ç®¡ç†ç³»ç»Ÿ
        let playingSounds = new Map(); // æ’­æ”¾å­—å…¸ï¼š{ å£°éŸ³åç§°: audioå¯¹è±¡ }
        let activeAudioObjects = new Set(); // æ´»è·ƒéŸ³é¢‘å¯¹è±¡é›†åˆ
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'ready') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function updatePlayingInfo() {
            document.getElementById('playingCount').textContent = playingSounds.size;
            const playingNames = Array.from(playingSounds.keys());
            document.getElementById('playingList').textContent = playingNames.length > 0 ? playingNames.join(', ') : 'æ— ';
            
            const soundListDiv = document.getElementById('soundList');
            soundListDiv.innerHTML = '';
            playingNames.forEach(name => {
                const soundItem = document.createElement('div');
                soundItem.className = 'sound-item';
                soundItem.textContent = name;
                soundListDiv.appendChild(soundItem);
            });
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function playSound(name) {
            log(`ğŸµ ===== å¼€å§‹æ’­æ”¾å£°éŸ³: ${name} =====`);
            updateStatus(`æ­£åœ¨æ’­æ”¾: ${name}`, 'playing');
            
            // åˆ›å»ºéŸ³é¢‘å¯¹è±¡
            let audio;
            if (name === 'karen') {
                // æ¨¡æ‹Ÿä¸å­˜åœ¨çš„å£°éŸ³ï¼Œåˆ›å»ºé»˜è®¤éŸ³é¢‘
                log(`ğŸµ å£°éŸ³ ${name} ä¸å­˜åœ¨ï¼Œåˆ›å»ºé»˜è®¤éŸ³é¢‘å¯¹è±¡`);
                
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                oscillator.type = 'sine';
                
                // åˆ›å»ºè™šæ‹ŸéŸ³é¢‘å¯¹è±¡
                audio = {
                    play: () => {
                        oscillator.start();
                        setTimeout(() => {
                            oscillator.stop();
                            oscillator.disconnect();
                            playingSounds.delete(name);
                            activeAudioObjects.delete(audio);
                            log(`ğŸµ é»˜è®¤éŸ³é¢‘æ’­æ”¾ç»“æŸ: ${name}`);
                            updatePlayingInfo();
                        }, 2000);
                        return Promise.resolve();
                    },
                    pause: () => {
                        oscillator.stop();
                        oscillator.disconnect();
                        playingSounds.delete(name);
                        activeAudioObjects.delete(audio);
                        log(`ğŸµ é»˜è®¤éŸ³é¢‘å·²æš‚åœ: ${name}`);
                        updatePlayingInfo();
                    },
                    currentTime: 0,
                    onended: null,
                    onerror: null
                };
            } else {
                // åˆ›å»ºçœŸå®çš„éŸ³é¢‘å¯¹è±¡
                audio = new Audio();
                audio.src = `data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT`;
                audio.loop = true;
                
                audio.onended = () => {
                    log(`ğŸµ éŸ³é¢‘æ’­æ”¾ç»“æŸ: ${name}`);
                    playingSounds.delete(name);
                    activeAudioObjects.delete(audio);
                    updatePlayingInfo();
                };
                audio.onerror = () => {
                    log(`ğŸµ éŸ³é¢‘æ’­æ”¾é”™è¯¯: ${name}`);
                    playingSounds.delete(name);
                    activeAudioObjects.delete(audio);
                    updatePlayingInfo();
                };
            }
            
            // æ·»åŠ åˆ°æ’­æ”¾å­—å…¸
            playingSounds.set(name, audio);
            activeAudioObjects.add(audio);
            log(`ğŸµ âœ… éŸ³é¢‘å¯¹è±¡å·²æ·»åŠ åˆ°æ’­æ”¾å­—å…¸: ${name}`);
            log(`ğŸµ å½“å‰æ­£åœ¨æ’­æ”¾çš„å£°éŸ³:`, Array.from(playingSounds.keys()));
            updatePlayingInfo();
            
            // å¼€å§‹æ’­æ”¾
            audio.play().catch(error => {
                log(`ğŸµ âŒ éŸ³é¢‘æ’­æ”¾å¤±è´¥: ${name}`, error);
                playingSounds.delete(name);
                activeAudioObjects.delete(audio);
                updatePlayingInfo();
            });
            
            log(`ğŸµ ===== æ’­æ”¾å£°éŸ³å®Œæˆ: ${name} =====`);
        }
        
        function stopSound(name) {
            log(`â¹ï¸ ===== åœæ­¢ç‰¹å®šå£°éŸ³: ${name} =====`);
            
            const audio = playingSounds.get(name);
            if (audio) {
                log(`ğŸµ æ‰¾åˆ°æ­£åœ¨æ’­æ”¾çš„å£°éŸ³: ${name}`);
                try {
                    audio.pause();
                    audio.currentTime = 0;
                    playingSounds.delete(name);
                    activeAudioObjects.delete(audio);
                    log(`ğŸµ âœ… æˆåŠŸåœæ­¢å£°éŸ³: ${name}`);
                    updateStatus(`å·²åœæ­¢: ${name}`, 'stopped');
                } catch (error) {
                    log(`ğŸµ âŒ åœæ­¢å£°éŸ³å¤±è´¥: ${name}`, error);
                }
            } else {
                log(`ğŸµ å£°éŸ³ ${name} æ²¡æœ‰åœ¨æ’­æ”¾`);
            }
            
            updatePlayingInfo();
            log(`â¹ï¸ ===== åœæ­¢ç‰¹å®šå£°éŸ³å®Œæˆ: ${name} =====`);
        }
        
        function stopAllSounds() {
            log(`â¹ï¸ ===== å¼€å§‹åœæ­¢æ‰€æœ‰å£°éŸ³ =====`);
            updateStatus('æ­£åœ¨åœæ­¢æ‰€æœ‰å£°éŸ³...', 'stopped');
            
            // æ–¹æ³•1: ä½¿ç”¨æ’­æ”¾å­—å…¸åœæ­¢æ‰€æœ‰æ­£åœ¨æ’­æ”¾çš„å£°éŸ³
            log(`ğŸµ æ–¹æ³•1: ä½¿ç”¨æ’­æ”¾å­—å…¸åœæ­¢æ‰€æœ‰æ­£åœ¨æ’­æ”¾çš„å£°éŸ³`);
            const playingSoundNames = Array.from(playingSounds.keys());
            log(`ğŸµ æ­£åœ¨æ’­æ”¾çš„å£°éŸ³:`, playingSoundNames);
            
            let stoppedPlayingCount = 0;
            playingSoundNames.forEach(soundName => {
                const audio = playingSounds.get(soundName);
                if (audio) {
                    try {
                        audio.pause();
                        audio.currentTime = 0;
                        playingSounds.delete(soundName);
                        activeAudioObjects.delete(audio);
                        stoppedPlayingCount++;
                        log(`ğŸµ âœ… æˆåŠŸåœæ­¢æ­£åœ¨æ’­æ”¾çš„å£°éŸ³: ${soundName}`);
                    } catch (error) {
                        log(`ğŸµ âŒ åœæ­¢æ­£åœ¨æ’­æ”¾çš„å£°éŸ³å¤±è´¥: ${soundName}`, error);
                    }
                }
            });
            log(`ğŸµ æ–¹æ³•1å®Œæˆ: åœæ­¢äº† ${stoppedPlayingCount} ä¸ªæ­£åœ¨æ’­æ”¾çš„å£°éŸ³`);
            
            // æ–¹æ³•2: ä½¿ç”¨æµè§ˆå™¨APIåœæ­¢æ‰€æœ‰åª’ä½“
            log(`ğŸµ æ–¹æ³•2: ä½¿ç”¨æµè§ˆå™¨APIåœæ­¢æ‰€æœ‰åª’ä½“`);
            try {
                const allMedia = document.querySelectorAll('audio, video');
                log(`ğŸµ æ‰¾åˆ° ${allMedia.length} ä¸ªåª’ä½“å…ƒç´ `);
                allMedia.forEach((media, index) => {
                    try {
                        media.pause();
                        media.currentTime = 0;
                        log(`ğŸµ âœ… åœæ­¢åª’ä½“å…ƒç´  ${index + 1}`);
                    } catch (error) {
                        log(`ğŸµ âš ï¸ åœæ­¢åª’ä½“å…ƒç´  ${index + 1} å¤±è´¥:`, error);
                    }
                });
            } catch (error) {
                log(`ğŸµ âš ï¸ æµè§ˆå™¨APIåœæ­¢åª’ä½“å¤±è´¥:`, error);
            }
            
            // æ¸…ç©ºæ‰€æœ‰é›†åˆ
            log(`ğŸµ æ¸…ç©ºæ‰€æœ‰éŸ³é¢‘å¯¹è±¡é›†åˆ`);
            playingSounds.clear();
            activeAudioObjects.clear();
            
            updatePlayingInfo();
            updateStatus('æ‰€æœ‰å£°éŸ³å·²åœæ­¢', 'ready');
            log(`â¹ï¸ ===== åœæ­¢æ‰€æœ‰å£°éŸ³å®Œæˆ =====`);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            log('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('ğŸ“‹ æµ‹è¯•è¯´æ˜: ç‚¹å‡»æ’­æ”¾æŒ‰é’®æµ‹è¯•å£°éŸ³ç®¡ç†ï¼Œç‚¹å‡»åœæ­¢æŒ‰é’®éªŒè¯åœæ­¢åŠŸèƒ½');
            updatePlayingInfo();
        });
    </script>
</body>
</html> 