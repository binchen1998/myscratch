# 声音管理功能说明

## 概述

本项目已成功添加了完整的声音管理功能，包括声音管理界面和声音积木，类似于Scratch中的声音功能。

## 新增功能

### 1. 声音管理按钮
- 在顶部控制栏添加了"🔊 声音管理"按钮
- 点击后打开声音管理模态框

### 2. 声音管理界面
- **添加声音**: 支持上传音频文件（MP3、WAV、OGG等格式）
- **删除声音**: 可以删除不需要的声音文件
- **播放预览**: 在管理界面中可以直接播放声音进行预览
- **文件大小限制**: 音频文件大小限制为10MB
- **时长显示**: 显示每个声音文件的时长

### 3. 声音积木分类
在Blockly工具箱中新增了"声音"分类，包含以下积木：

#### 播放控制积木
- **播放声音**: 播放指定的声音文件
- **播放声音等待播完**: 播放声音并等待播放完成
- **停止所有声音**: 停止所有正在播放的声音

#### 音效控制积木
- **将音调音效增加**: 改变音调效果
- **将音调音效设为**: 设置音调效果
- **清除音效**: 清除所有音效设置

#### 音量控制积木
- **将音量增加**: 改变音量
- **将音量设为**: 设置音量百分比
- **音量**: 获取当前音量值

## 技术实现

### 文件结构
- `sound-manager.js`: 声音管理核心功能
- `index.html`: 添加了声音管理按钮和模态框
- `style.css`: 添加了声音管理相关样式
- `blockly-config.js`: 添加了声音积木定义和代码生成器

### 核心功能
1. **声音存储**: 使用DataURL格式存储音频数据
2. **音频播放**: 使用Web Audio API进行音频播放
3. **文件处理**: 支持多种音频格式的文件上传
4. **积木集成**: 与Blockly积木系统完全集成

### 积木代码生成
声音积木会生成相应的JavaScript代码：
- 播放声音: `playSoundByName('soundName', false);`
- 播放并等待: `await playSoundByName('soundName', true);`
- 停止所有: `stopAllSounds();`
- 音量控制: `setVolume(volume);`

## 使用方法

### 1. 添加声音
1. 点击顶部"🔊 声音管理"按钮
2. 在模态框中点击"+ 添加声音"
3. 选择音频文件（支持MP3、WAV、OGG等格式）
4. 文件会自动上传并添加到声音库

### 2. 使用声音积木
1. 在Blockly工具箱中找到"声音"分类
2. 拖拽声音积木到工作区
3. 在积木中选择要播放的声音
4. 运行程序即可听到声音效果

### 3. 管理声音
- 在声音管理界面中可以预览、删除声音
- 支持批量管理多个声音文件
- 实时显示声音列表和状态

## 浏览器兼容性

- 支持所有现代浏览器（Chrome、Firefox、Safari、Edge）
- 需要支持Web Audio API
- 支持HTML5音频格式

## 注意事项

1. **文件大小**: 音频文件大小限制为10MB
2. **格式支持**: 支持常见的音频格式（MP3、WAV、OGG等）
3. **浏览器权限**: 某些浏览器可能需要用户授权才能播放音频
4. **性能考虑**: 大量音频文件可能影响页面性能

## 测试

可以使用 `test-sound.html` 文件来测试声音管理功能：
1. 打开 `test-sound.html`
2. 测试各种声音管理功能
3. 验证积木代码生成是否正确

## 未来扩展

可以考虑添加以下功能：
- 音频编辑功能（裁剪、合并等）
- 更多音效选项（回声、混响等）
- 音频可视化效果
- 在线音频库集成 